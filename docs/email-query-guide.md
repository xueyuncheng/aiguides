# 邮件查询功能使用指南

## 功能概述

AI 助手现在支持通过 IMAP 协议查询您的邮箱。当您请求查询邮件时，系统会自动检测是否已配置邮件服务器。

## 使用流程

### 1. 首次使用

当您第一次请求查询邮件时（例如："帮我看看最近有没有什么重要的邮件"），如果还没有配置邮件服务器，AI 助手会：

1. 返回一个配置页面链接（例如：`http://localhost:3000/settings/email-servers`）
2. 提示您前往该页面配置邮件服务器信息

### 2. 配置邮件服务器

访问配置页面后，您需要提供以下信息：

- **配置名称**：自定义名称，用于识别这个邮箱（例如："我的 Gmail"）
- **服务器地址**：IMAP 服务器地址和端口（例如：`imap.gmail.com:993`）
- **邮箱账号**：您的邮箱地址
- **密码**：邮箱密码或应用专用密码（强烈建议使用应用专用密码）
- **邮箱文件夹**：默认为 INBOX（收件箱）
- **设为默认邮箱**：如果有多个邮箱，可以设置默认邮箱

#### 常见邮箱服务器配置

| 邮箱服务商 | IMAP 服务器地址 | 端口 |
|-----------|----------------|------|
| Gmail | imap.gmail.com | 993 |
| Outlook/Hotmail | outlook.office365.com | 993 |
| QQ 邮箱 | imap.qq.com | 993 |
| 163 邮箱 | imap.163.com | 993 |
| 126 邮箱 | imap.126.com | 993 |

#### 安全提示

- **Gmail 用户**：需要开启"允许不够安全的应用访问"或使用应用专用密码
- **建议**：使用应用专用密码而不是账户密码，以提高安全性

### 3. 配置完成后查询

配置完成后，返回聊天页面，告诉 AI 助手"已配置"或"已提交信息"，AI 助手会重新查询您的邮件。

### 4. 查询结果

查询成功后，AI 助手会：
- 列出符合条件的邮件
- 显示邮件的发件人、主题、日期等信息
- 根据您的请求分析和总结邮件内容

## 示例对话

```
用户：帮我看看最近有没有什么重要的邮件

AI：我需要访问您的邮箱来查询邮件。请先前往以下链接配置您的邮件服务器信息：
http://localhost:3000/settings/email-servers

配置完成后，请告诉我"已配置"，我会重新查询。

用户：已配置

AI：好的，正在查询您的邮件...
[查询结果]
```

## 管理邮件服务器配置

您可以随时访问 `/settings/email-servers` 页面来：

- 添加新的邮件服务器
- 编辑现有配置
- 删除不再使用的配置
- 设置默认邮箱

## 隐私和安全

- 您的邮件服务器配置信息存储在本地数据库中
- 密码以明文形式存储（未来版本会加密）
- 只有您本人能访问您的邮件配置
- AI 助手只在您明确请求时才查询邮件

## 故障排除

### 连接失败

如果连接失败，请检查：
1. 服务器地址和端口是否正确
2. 用户名和密码是否正确
3. 是否已启用 IMAP 访问（在邮箱设置中）
4. 是否需要使用应用专用密码

### Gmail 特殊说明

Gmail 用户需要：
1. 启用 IMAP：设置 → 转发和 POP/IMAP → 启用 IMAP
2. 使用应用专用密码：
   - 访问 Google 账户安全设置
   - 启用两步验证
   - 生成应用专用密码
   - 使用生成的密码而不是账户密码

## 技术限制

当前版本的限制：
- 每次查询最多返回 50 封邮件
- 只支持 IMAP 协议（不支持 POP3）
- 不支持发送邮件（仅查询）
- 密码未加密存储（未来版本会改进）

## 未来改进计划

- [ ] 密码加密存储
- [ ] 支持从多个邮箱同时查询
- [ ] 邮件内容智能分类
- [ ] 邮件重要性评分
- [ ] 邮件摘要和翻译
